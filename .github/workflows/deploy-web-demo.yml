name: Deploy Web Demo

on:
  push:
    branches: [ main, feature/swipe-typing ]
    paths: [ 'web_demo/**' ]
  workflow_dispatch:

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          lfs: true
          
      - name: Prepare deployment files
        run: |
          cd web_demo
          echo "ğŸ“ Web demo files:"
          ls -la
          
          # Create deployment directory
          mkdir -p ../deploy
          
          # Copy all necessary files
          echo "ğŸ“¦ Copying files..."
          cp *.html ../deploy/ 2>/dev/null || echo "No HTML files"
          cp *.js ../deploy/ 2>/dev/null || echo "No JS files"  
          cp *.json ../deploy/ 2>/dev/null || echo "No JSON files"
          cp *.onnx ../deploy/ 2>/dev/null || echo "No ONNX files"
          
          # Ensure main HTML file becomes index.html
          if [ -f swipe-onnx.html ]; then
            cp swipe-onnx.html ../deploy/index.html
            echo "âœ… Main file: swipe-onnx.html â†’ index.html"
          else
            echo "âŒ No main HTML file found!"
            exit 1
          fi
          
          cd ../deploy
          echo "ğŸš€ Deployment files ready:"
          ls -la
          echo "ğŸ“Š File sizes:"
          du -h *

      - name: Deploy to GitHub Pages
        uses: peaceiris/actions-gh-pages@v4
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          publish_dir: ./deploy
          publish_branch: gh-pages
          force_orphan: true
          commit_message: 'Deploy web demo from ${{ github.sha }}'